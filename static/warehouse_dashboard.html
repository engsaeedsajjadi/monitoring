<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø¨Ø§Ø± - Ø´Ø±Ú©Øª ÙØ±Ø¯Ø§Ø¯ Ø³Ø§Ø²Ù‡ Ú¯Ù„Ø´Ù†</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        /* [ CSS styles from your code - No changes needed here, keeping it as is ] */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Vazirmatn', 'B Nazanin', Tahoma, sans-serif; background-color: #f5f6fa; color: #2c3e50; line-height: 1.6; }
        .dashboard-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .dashboard-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .dashboard-header h1 { font-size: 24px; font-weight: bold; }
        .header-actions { display: flex; align-items: center; gap: 15px; }
        .user-info { background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 14px; }
        .main-tabs { display: flex; background: white; border-radius: 15px; padding: 10px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow-x: auto; }
        .tab-btn { padding: 12px 20px; border: none; background: none; cursor: pointer; border-radius: 10px; font-family: inherit; font-weight: bold; transition: all 0.3s ease; white-space: nowrap; }
        .tab-btn.active { background: #3498db; color: white; }
        .tab-btn:hover:not(.active) { background: #f8f9fa; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 20px; transition: transform 0.3s ease; }
        .card:hover { transform: translateY(-5px); }
        .card-icon { font-size: 40px; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
        .stock-card .card-icon { background: #e3f2fd; color: #1976d2; }
        .low-stock-card .card-icon { background: #ffebee; color: #d32f2f; }
        .transaction-card .card-icon { background: #e8f5e8; color: #388e3c; }
        .warehouse-card .card-icon { background: #f3e5f5; color: #7b1fa2; }
        .card-content h3 { font-size: 14px; color: #666; margin-bottom: 5px; }
        .card-value { font-size: 28px; font-weight: bold; color: #2c3e50; }
        .charts-section { margin-bottom: 30px; }
        .chart-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .chart-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .chart-card h3 { margin-bottom: 15px; color: #2c3e50; }
        .chart { height: 300px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-header h2 { color: #2c3e50; }
        .section-controls { display: flex; gap: 15px; align-items: center; }
        .table-container { overflow-x: auto; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: right; border-bottom: 1px solid #eee; }
        .data-table th { background-color: #f8f9fa; font-weight: bold; color: #2c3e50; position: sticky; top: 0; }
        .data-table tr:hover { background-color: #f8f9fa; }
        .search-input, .filter-select { padding: 10px 15px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; min-width: 200px; }
        .form-row { display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 14px; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #3498db; box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2); }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-family: inherit; font-size: 14px; font-weight: bold; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }
        .btn-sm { padding: 8px 16px; font-size: 12px; }
        .btn-xs { padding: 6px 12px; font-size: 11px; }
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover { background: #2980b9; }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #219a52; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-warning:hover { background: #e67e22; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-secondary { background: #95a5a6; color: white; }
        .btn-secondary:hover { background: #7f8c8d; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-info:hover { background: #138496; }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .status-normal { background: #d4edda; color: #155724; }
        .status-low { background: #f8d7da; color: #721c24; }
        .status-critical { background: #f5c6cb; color: #721c24; }
        .transaction-badge { padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; }
        .transaction-badge.in { background: #d4edda; color: #155724; }
        .transaction-badge.out { background: #f8d7da; color: #721c24; }
        .alerts-section { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .alert-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .alert-badge { background: #d32f2f; color: white; padding: 5px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; }
        .alert-item { background: #ffebee; border: 1px solid #ffcdd2; border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .alert-item.warning { background: #fff3e0; border-color: #ffcc80; }
        .alert-item.critical { background: #ffebee; border-color: #ef5350; }
        .panel-config-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .config-form-section, .config-list-section { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .panel-config-group { background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        .config-group-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .config-items-list { display: flex; flex-direction: column; gap: 8px; }
        .config-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; border-radius: 8px; border: 1px solid #eee; }
        .config-item .quantity { font-weight: bold; color: #3498db; }
        .reports-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .report-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; }
        .report-card h3 { margin-bottom: 10px; color: #2c3e50; }
        .report-card p { color: #666; margin-bottom: 20px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 5% auto; padding: 0; border-radius: 15px; width: 90%; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .modal-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { margin: 0; }
        .close { font-size: 24px; cursor: pointer; }
        .modal-body { padding: 20px; }
        .form-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; color: white; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 10000; max-width: 400px; animation: slideIn 0.3s ease; }
        .notification.success { background: #27ae60; }
        .notification.error { background: #e74c3c; }
        .notification.info { background: #3498db; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @media (max-width: 768px) { .chart-container, .panel-config-container { grid-template-columns: 1fr; } .summary-cards { grid-template-columns: 1fr; } .section-header { flex-direction: column; gap: 15px; align-items: flex-start; } .section-controls, .form-row { flex-direction: column; width: 100%; } .search-input, .filter-select { min-width: auto; width: 100%; } .header-actions { flex-direction: column; gap: 10px; } .main-tabs { flex-wrap: wrap; } }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- [ HTML content from your code - No changes needed here ] -->
        <header class="dashboard-header">
            <h1>ğŸšš Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø¨Ø§Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡</h1>
            <div class="header-actions">
                <button id="refreshBtn" class="btn btn-primary">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
                <span id="currentUser" class="user-info"></span>
                <button id="logoutBtn" class="btn btn-secondary">Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>
        <nav class="main-tabs">
            <button class="tab-btn active" data-tab="dashboard">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
            <button class="tab-btn" data-tab="inventory">ğŸ“¦ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ</button>
            <button class="tab-btn" data-tab="transactions">ğŸ”„ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</button>
            <button class="tab-btn" data-tab="panel-config">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªØ§Ø¨Ù„ÙˆÙ‡Ø§</button>
            <button class="tab-btn" data-tab="reports">ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</button>
        </nav>
        <div class="tab-content">
            <div id="tab-dashboard" class="tab-pane active">
                <section class="summary-cards">
                    <div class="card stock-card"><div class="card-icon">ğŸ“¦</div><div class="card-content"><h3>Ú©Ù„ Ú©Ø§Ù„Ø§Ù‡Ø§</h3><span id="totalItems" class="card-value">0</span></div></div>
                    <div class="card low-stock-card"><div class="card-icon">âš ï¸</div><div class="card-content"><h3>Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù…</h3><span id="lowStockItems" class="card-value">0</span></div></div>
                    <div class="card transaction-card"><div class="card-icon">ğŸ“Š</div><div class="card-content"><h3>ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</h3><span id="todayTransactions" class="card-value">0</span></div></div>
                    <div class="card warehouse-card"><div class="card-icon">ğŸ­</div><div class="card-content"><h3>Ø§Ù†Ø¨Ø§Ø±Ù‡Ø§</h3><span id="totalWarehouses" class="card-value">0</span></div></div>
                </section>
                <section class="charts-section"><div class="chart-container"><div class="chart-card"><h3>ğŸ“ˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†Ø¨Ø§Ø±</h3><div id="warehouseStockChart" class="chart"></div></div><div class="chart-card"><h3>ğŸ”„ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h3><div id="transactionTrendChart" class="chart"></div></div></div></section>
                <section class="alerts-section" id="alertsSection"><div class="alert-header"><h2>ğŸš¨ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ù…</h2><span class="alert-badge" id="alertCount">0</span></div><div id="alertsContainer" class="alerts-container"></div></section>
            </div>
            <div id="tab-inventory" class="tab-pane">
                <div class="section-header"><h2>ğŸ“¦ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¨Ø§Ø±</h2><div class="section-controls"><input type="text" id="searchInventory" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ù„Ø§..." class="search-input"><select id="warehouseFilter" class="filter-select"><option value="">Ù‡Ù…Ù‡ Ø§Ù†Ø¨Ø§Ø±Ù‡Ø§</option></select><button id="addItemBtn" class="btn btn-success">â• Ú©Ø§Ù„Ø§ÛŒ Ø¬Ø¯ÛŒØ¯</button></div></div>
                <div class="table-container"><table id="inventoryTable" class="data-table"><thead><tr><th>Ù†Ø§Ù… Ú©Ø§Ù„Ø§</th><th>Ø§Ù†Ø¨Ø§Ø±</th><th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ</th><th>Ø­Ø¯Ø§Ù‚Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead><tbody id="inventoryTableBody"></tbody></table></div>
            </div>
            <div id="tab-transactions" class="tab-pane">
                <div class="section-header"><h2>ğŸ”„ Ù…Ø¯ÛŒØ±ÛŒØª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h2><div class="section-controls"><button id="addStockBtn" class="btn btn-success">â• ÙˆØ±ÙˆØ¯ Ú©Ø§Ù„Ø§</button><button id="removeStockBtn" class="btn btn-warning">â– Ø®Ø±ÙˆØ¬ Ú©Ø§Ù„Ø§</button><select id="transactionTypeFilter"><option value="">Ù‡Ù…Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</option><option value="IN">ÙˆØ±ÙˆØ¯</option><option value="OUT">Ø®Ø±ÙˆØ¬</option></select></div></div>
                <div class="table-container"><table id="transactionsTable" class="data-table"><thead><tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ù†ÙˆØ¹</th><th>Ú©Ø§Ù„Ø§</th><th>Ø§Ù†Ø¨Ø§Ø±</th><th>ØªØ¹Ø¯Ø§Ø¯</th><th>Ù¾Ø±ÙˆÚ˜Ù‡</th><th>Ú©Ø§Ø±Ø¨Ø±</th><th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th></tr></thead><tbody id="transactionsTableBody"></tbody></table></div>
            </div>
            <div id="tab-panel-config" class="tab-pane">
                <div class="section-header"><h2>âš™ï¸ ØªØ¹Ø±ÛŒÙ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ú©Ø¯Ù‡Ø§ÛŒ ØªØ§Ø¨Ù„Ùˆ</h2></div>
                <div class="panel-config-container">
                    <div class="config-form-section"><h3>ØªØ¹Ø±ÛŒÙ/ÙˆÛŒØ±Ø§ÛŒØ´ ØªØ¬Ù‡ÛŒØ²Ø§Øª</h3><form id="panelConfigForm"><div class="form-group"><label for="panelCodeSelect">Ú©Ø¯ ØªØ§Ø¨Ù„Ùˆ:</label><select id="panelCodeSelect" required><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø¯ ØªØ§Ø¨Ù„Ùˆ</option></select></div><div id="panelItemsContainer"></div><button type="button" id="addPanelItemRowBtn" class="btn btn-info btn-sm">â• Ø§ÙØ²ÙˆØ¯Ù† Ø¢ÛŒØªÙ…</button><div class="form-actions"><button type="submit" class="btn btn-primary">Ø°Ø®ÛŒØ±Ù‡ BOM</button></div></form></div>
                    <div class="config-list-section"><h3>Ù„ÛŒØ³Øª BOM Ù‡Ø§ÛŒ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡</h3><div id="panelConfigsContainer"></div></div>
                </div>
            </div>
            <div id="tab-reports" class="tab-pane">
                <div class="section-header"><h2>ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¨Ø§Ø±</h2></div>
                <div class="reports-grid">
                    <div class="report-card"><h3>ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</h3><p>Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØªÙ…Ø§Ù… Ø§Ù†Ø¨Ø§Ø±Ù‡Ø§</p><button class="btn btn-primary" onclick="dashboard.generateInventoryReport('pdf')">ğŸ“„ Ø¯Ø±ÛŒØ§ÙØª PDF</button><button class="btn btn-success" onclick="dashboard.generateInventoryReport('excel')">ğŸ“Š Ø¯Ø±ÛŒØ§ÙØª Excel</button></div>
                    <div class="report-card"><h3>ğŸ”„ Ú¯Ø²Ø§Ø±Ø´ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h3><p>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§Ù…Ù„ ÙˆØ±ÙˆØ¯ Ùˆ Ø®Ø±ÙˆØ¬ Ú©Ø§Ù„Ø§Ù‡Ø§</p><button class="btn btn-primary" onclick="dashboard.generateTransactionReport('pdf')">ğŸ“„ Ø¯Ø±ÛŒØ§ÙØª PDF</button><button class="btn btn-success" onclick="dashboard.generateTransactionReport('excel')">ğŸ“Š Ø¯Ø±ÛŒØ§ÙØª Excel</button></div>
                    <div class="report-card"><h3>âš ï¸ Ú¯Ø²Ø§Ø±Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù…</h3><p>Ù„ÛŒØ³Øª Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ù‡ Ø­Ø¯Ø§Ù‚Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø±Ø³ÛŒØ¯Ù‡â€ŒØ§Ù†Ø¯</p><button class="btn btn-warning" onclick="dashboard.generateLowStockReport()">ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú¯Ø²Ø§Ø±Ø´</button></div>
                </div>
            </div>
        </div>
    </div>
    <div id="stockModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 id="modalTitle"></h3><span class="close">&times;</span></div><div class="modal-body"><form id="stockForm"><input type="hidden" id="transactionType"><div class="form-group"><label for="warehouseSelectModal">Ø§Ù†Ø¨Ø§Ø±:</label><select id="warehouseSelectModal" required></select></div><div class="form-group"><label for="itemSelectModal">Ú©Ø§Ù„Ø§:</label><select id="itemSelectModal" required></select></div><div class="form-group"><label for="quantityInput">ØªØ¹Ø¯Ø§Ø¯:</label><input type="number" id="quantityInput" min="1" required></div><div class="form-group"><label for="notesInput">ØªÙˆØ¶ÛŒØ­Ø§Øª:</label><textarea id="notesInput" rows="3"></textarea></div><div class="form-group" id="projectGroup"><label for="projectSelect">Ù¾Ø±ÙˆÚ˜Ù‡ (Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬):</label><select id="projectSelect"></select></div><div class="form-actions"><button type="submit" class="btn btn-primary">Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´</button><button type="button" class="btn btn-secondary" id="cancelBtn">Ø§Ù†ØµØ±Ø§Ù</button></div></form></div></div></div>
    <div id="itemModal" class="modal"><div class="modal-content"><div class="modal-header"><h3></h3><span class="close">&times;</span></div><div class="modal-body"><form id="itemForm"><input type="hidden" id="itemId"><div class="form-group"><label for="itemName">Ù†Ø§Ù… Ú©Ø§Ù„Ø§:</label><input type="text" id="itemName" required></div><div class="form-group"><label for="itemDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª:</label><textarea id="itemDescription" rows="3"></textarea></div><div class="form-group"><label for="minStockLevel">Ø­Ø¯Ø§Ù‚Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ:</label><input type="number" id="minStockLevel" min="0" value="0"></div><div class="form-actions"><button type="submit" class="btn btn-primary">Ø«Ø¨Øª Ú©Ø§Ù„Ø§</button><button type="button" class="btn btn-secondary" onclick="dashboard.closeAllModals()">Ø§Ù†ØµØ±Ø§Ù</button></div></form></div></div></div>
    
    <script>
        // ==========================================================
        // âœ…âœ…âœ… Ú©Ø¯ Ú©Ø§Ù…Ù„ Ùˆ Ù†Ù‡Ø§ÛŒÛŒ Ø¬Ø§ÙˆØ§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ø§ Ù…Ù†Ø·Ù‚ Ù‡Ø¯Ø§ÛŒØª âœ…âœ…âœ…
        // ==========================================================
        class WarehouseDashboard {
            constructor() {
                this.token = localStorage.getItem('accessToken');
                this.currentUser = null;
                this.inventoryData = [];
                this.warehouses = [];
                this.items = [];
                this.projects = [];
                this.transactions = [];
                this.panelConfigs = {};
                this.panelCodes = [];
                this.charts = {};
                this.init();
            }

            async init() {
                // Ø§ÙˆÙ„ÛŒÙ† Ú©Ø§Ø±ØŒ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø§Ø³Øª
                await this.checkAuth(); 
                // Ø§Ú¯Ø± checkAuth Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯ØŒ Ø¨Ù‚ÛŒÙ‡ Ú©Ø§Ø±Ù‡Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯
                this.setupEventListeners();
                await this.loadInitialData();
                this.setupWebSocket();
            }

            async checkAuth() {
                if (!this.token) {
                    this.logout(); // Ø§Ú¯Ø± ØªÙˆÚ©Ù† Ù†Ø¨ÙˆØ¯ØŒ Ø¨Ù‡ Ù„Ø§Ú¯ÛŒÙ† Ù‡Ø¯Ø§ÛŒØª Ø´Ùˆ
                    // Ø¨Ø§ Ù¾Ø±ØªØ§Ø¨ Ø®Ø·Ø§ØŒ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ init Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                    throw new Error("Redirecting to login.");
                }
                try {
                    const user = await this.apiFetch('/auth/me');
                    this.currentUser = user;
                    document.getElementById('currentUser').textContent = `Ú©Ø§Ø±Ø¨Ø±: ${user.name}`;
                } catch (error) {
                    // apiFetch Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ÛŒ 401/403 Ø®ÙˆØ¯Ø´ logout Ø±Ø§ ØµØ¯Ø§ Ù…ÛŒâ€ŒØ²Ù†Ø¯
                    console.error('Auth check failed:', error.message);
                    throw error; // Ø§Ø¬Ø±Ø§ÛŒ init Ø±Ø§ Ù…ØªÙˆÙ‚Ù Ú©Ù†
                }
            }

            logout = () => {
                const currentPath = window.location.pathname + window.location.search;
                localStorage.removeItem('accessToken');
                localStorage.removeItem('userData');
                // Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¨Ù‡ ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† Ø¨ÙØ±Ø³Øª Ùˆ Ø¢Ø¯Ø±Ø³ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù¾Ø§Ø±Ø§Ù…ØªØ± next Ø¨Ø¯Ù‡
                window.location.href = `/login?next=${encodeURIComponent(currentPath)}`;
            }

            apiFetch = async (endpoint, options = {}) => {
                const headers = { 'Content-Type': 'application/json', ...options.headers };
                // Ø¯Ø± Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¯ÛŒÚ¯Ø± ØªÙˆÚ©Ù† Ø±Ø§ Ú†Ú© Ù†Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…ØŒ Ú†ÙˆÙ† checkAuth Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ Ú©Ø±Ø¯Ù‡
                headers['Authorization'] = `Bearer ${this.token}`;
                
                try {
                    const response = await fetch(endpoint, { ...options, headers });
                    if ([401, 403].includes(response.status)) { 
                        this.logout(); 
                        throw new Error('Unauthorized'); 
                    }
                    if (response.status === 204) return null;
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.detail || `HTTP Error: ${response.status}`);
                    return data;
                } catch (error) {
                    if (error.message !== 'Unauthorized') {
                        this.showNotification(error.message, 'error');
                    }
                    throw error;
                }
            }
            
            async loadInitialData() {
                this.showNotification('Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...', 'info');
                try {
                    const [inventory, warehouses, items, projects, transactions] = await Promise.all([
                        this.apiFetch('/inventory/items/'),
                        this.apiFetch('/warehouses/'),
                        this.apiFetch('/warehouse-items/'),
                        this.apiFetch('/projects/'),
                        this.apiFetch('/inventory/history/')
                    ]);
                    
                    this.inventoryData = inventory;
                    this.warehouses = warehouses;
                    this.items = items;
                    this.projects = projects;
                    this.transactions = transactions;

                    await this.loadPanelData();
                    this.renderAll();
                    this.showNotification('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯.', 'success');
                } catch (error) {
                    console.error('Failed to load initial data:', error);
                }
            }

            async loadPanelData() {
                this.panelCodes = [...new Set(this.projects.map(p => p.panel_code).filter(Boolean))].sort();
                
                this.panelConfigs = {}; // Reset configs
                for (const code of this.panelCodes) {
                    try {
                        const items = await this.apiFetch(`/inventory/panel-items/${code}`);
                        if (items && items.length > 0) {
                            this.panelConfigs[code] = items;
                        }
                    } catch (e) { /* Ignore if a panel code has no config */ }
                }
            }

            renderAll() {
                this.activateTab(document.querySelector('.tab-btn.active').dataset.tab);
                this.renderInventoryTable();
                this.populateSelects();
                this.renderTransactionsTable();
                this.renderPanelConfigs();
                this.updateSummary();
                this.updateCharts();
                this.showLowStockAlerts();
            }
            
            setupEventListeners() {
                document.getElementById('refreshBtn').addEventListener('click', () => this.loadInitialData());
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
                document.querySelectorAll('.tab-btn').forEach(btn => btn.addEventListener('click', e => this.activateTab(e.target.dataset.tab)));
                document.getElementById('addItemBtn').addEventListener('click', () => this.showItemModal());
                document.getElementById('addStockBtn').addEventListener('click', () => this.showStockModal('IN'));
                document.getElementById('removeStockBtn').addEventListener('click', () => this.showStockModal('OUT'));
                document.getElementById('stockForm').addEventListener('submit', e => this.handleStockFormSubmit(e));
                document.getElementById('itemForm').addEventListener('submit', e => this.handleItemFormSubmit(e));
                document.querySelectorAll('.modal .close, #cancelBtn').forEach(el => el.addEventListener('click', () => this.closeAllModals()));
                document.getElementById('searchInventory').addEventListener('input', () => this.renderInventoryTable());
                document.getElementById('warehouseFilter').addEventListener('change', () => this.renderInventoryTable());
                document.getElementById('transactionTypeFilter').addEventListener('change', () => this.renderTransactionsTable());
                document.getElementById('panelConfigForm').addEventListener('submit', e => this.handlePanelConfigSubmit(e));
                document.getElementById('addPanelItemRowBtn').addEventListener('click', () => this.addPanelItemRow());
                document.getElementById('panelCodeSelect').addEventListener('change', e => this.populatePanelItemsForEdit(e.target.value));
            }

            activateTab(tabId) {
                document.querySelectorAll('.tab-btn, .tab-pane').forEach(el => el.classList.remove('active'));
                document.querySelector(`.tab-btn[data-tab="${tabId}"]`).classList.add('active');
                document.getElementById(`tab-${tabId}`).classList.add('active');
            }

            updateSummary() {
                const todayStart = new Date();
                todayStart.setHours(0, 0, 0, 0);
                const todayTransactions = this.transactions.filter(t => new Date(t.timestamp) >= todayStart);
                const lowStockItemsCount = this.inventoryData.filter(i => i.min_stock_level > 0 && i.current_stock <= i.min_stock_level).length;

                document.getElementById('totalItems').textContent = this.items.length;
                document.getElementById('lowStockItems').textContent = lowStockItemsCount;
                document.getElementById('todayTransactions').textContent = todayTransactions.length;
                document.getElementById('totalWarehouses').textContent = this.warehouses.length;
            }

            renderInventoryTable() {
                const tbody = document.getElementById('inventoryTableBody');
                const searchTerm = document.getElementById('searchInventory').value.toLowerCase();
                const warehouseFilter = document.getElementById('warehouseFilter').value;
                tbody.innerHTML = '';

                const filtered = this.inventoryData.filter(item => 
                    (item.item_name.toLowerCase().includes(searchTerm)) && 
                    (!warehouseFilter || item.warehouse_id == warehouseFilter)
                );

                if (filtered.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding: 20px;">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>';
                    return;
                }

                filtered.forEach(item => {
                    const status = this.getStockStatus(item.current_stock, item.min_stock_level);
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.item_name}</td>
                            <td>${item.warehouse_name}</td>
                            <td>${item.current_stock}</td>
                            <td>${item.min_stock_level}</td>
                            <td><span class="status-badge status-${status}">${this.getStatusText(status)}</span></td>
                            <td>
                                <button class="btn btn-primary btn-xs" onclick="dashboard.showStockModal('IN', '${item.item_name}', ${item.warehouse_id})">â• ÙˆØ±ÙˆØ¯</button>
                                <button class="btn btn-warning btn-xs" onclick="dashboard.showStockModal('OUT', '${item.item_name}', ${item.warehouse_id})">â– Ø®Ø±ÙˆØ¬</button>
                            </td>
                        </tr>`;
                });
            }

            renderTransactionsTable() {
                const tbody = document.getElementById('transactionsTableBody');
                const typeFilter = document.getElementById('transactionTypeFilter').value;
                tbody.innerHTML = '';
                
                const filtered = this.transactions.filter(t => !typeFilter || t.transaction_type === typeFilter).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                filtered.forEach(t => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${new Date(t.timestamp).toLocaleString('fa-IR')}</td>
                            <td><span class="transaction-badge ${t.transaction_type.toLowerCase()}">${t.transaction_type === 'IN' ? 'ÙˆØ±ÙˆØ¯' : 'Ø®Ø±ÙˆØ¬'}</span></td>
                            <td>${t.item.item_name}</td>
                            <td>${t.warehouse.name}</td>
                            <td>${t.quantity}</td>
                            <td>${t.project ? t.project.request_id : '-'}</td>
                            <td>${t.user.name}</td>
                            <td>${t.notes || '-'}</td>
                        </tr>`;
                });
            }

            renderPanelConfigs() {
                const container = document.getElementById('panelConfigsContainer');
                container.innerHTML = '';
                Object.entries(this.panelConfigs).forEach(([code, items]) => {
                    container.innerHTML += `
                        <div class="panel-config-group">
                            <div class="config-group-header">
                                <h4>${code}</h4>
                                <button class="btn btn-info btn-xs" onclick="dashboard.editPanelConfig('${code}')">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            </div>
                            <div class="config-items-list">
                                ${items.map(item => `<div class="config-item"><span>${item.item_name}</span><span class="quantity">${item.quantity_required} Ø¹Ø¯Ø¯</span></div>`).join('')}
                            </div>
                        </div>`;
                });
            }

            populateSelects() {
                const whSelects = document.querySelectorAll('#warehouseFilter, #warehouseSelectModal');
                whSelects.forEach(select => {
                    const currentVal = select.value;
                    select.innerHTML = `<option value="">${select.id === 'warehouseFilter' ? 'Ù‡Ù…Ù‡ Ø§Ù†Ø¨Ø§Ø±Ù‡Ø§' : 'Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ù†Ø¨Ø§Ø±'}</option>`;
                    this.warehouses.forEach(w => select.innerHTML += `<option value="${w.id}">${w.name}</option>`);
                    select.value = currentVal;
                });
                
                const itemSelects = document.querySelectorAll('#itemSelectModal, .config-item-select'); // This class is dynamic now
                itemSelects.forEach(select => {
                    select.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ù„Ø§</option>';
                    this.items.sort((a,b) => a.item_name.localeCompare(b.item_name)).forEach(i => select.innerHTML += `<option value="${i.item_name}">${i.item_name}</option>`);
                });
                
                const projSelect = document.getElementById('projectSelect');
                projSelect.innerHTML = '<option value="">Ø¨Ø¯ÙˆÙ† Ù¾Ø±ÙˆÚ˜Ù‡</option>';
                this.projects.forEach(p => projSelect.innerHTML += `<option value="${p.id}">${p.name} (${p.request_id})</option>`);
                
                const panelCodeSelect = document.getElementById('panelCodeSelect');
                panelCodeSelect.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø¯ ØªØ§Ø¨Ù„Ùˆ</option>';
                this.panelCodes.forEach(code => panelCodeSelect.innerHTML += `<option value="${code}">${code}</option>`);
            }

            showStockModal(type, itemName = '', warehouseId = '') {
                const form = document.getElementById('stockForm');
                form.reset();
                document.getElementById('modalTitle').textContent = type === 'IN' ? 'Ø«Ø¨Øª ÙˆØ±ÙˆØ¯ Ú©Ø§Ù„Ø§' : 'Ø«Ø¨Øª Ø®Ø±ÙˆØ¬ Ú©Ø§Ù„Ø§';
                document.getElementById('transactionType').value = type;
                document.getElementById('projectGroup').style.display = type === 'OUT' ? 'block' : 'none';
                if (itemName) document.getElementById('itemSelectModal').value = itemName;
                if (warehouseId) document.getElementById('warehouseSelectModal').value = warehouseId;
                document.getElementById('stockModal').style.display = 'block';
            }

            showItemModal(item = null) {
                const form = document.getElementById('itemForm');
                form.reset();
                const modal = document.getElementById('itemModal');
                modal.querySelector('h3').textContent = item ? 'ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ù„Ø§' : 'Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù„Ø§ÛŒ Ø¬Ø¯ÛŒØ¯';
                document.getElementById('itemId').value = item ? item.id : '';
                if(item) {
                    document.getElementById('itemName').value = item.item_name;
                    document.getElementById('itemDescription').value = item.description || '';
                    document.getElementById('minStockLevel').value = item.min_stock_level;
                }
                modal.style.display = 'block';
            }

            closeAllModals() {
                document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
            }

            async handleStockFormSubmit(e) {
                e.preventDefault();
                const type = document.getElementById('transactionType').value;
                const payload = {
                    warehouse_id: parseInt(document.getElementById('warehouseSelectModal').value),
                    item_name: document.getElementById('itemSelectModal').value,
                    quantity: parseInt(document.getElementById('quantityInput').value),
                    notes: document.getElementById('notesInput').value,
                    ...(type === 'OUT' && { project_id: parseInt(document.getElementById('projectSelect').value) || null })
                };
                try {
                    await this.apiFetch(`/inventory/${type.toLowerCase()}/`, { method: 'POST', body: JSON.stringify(payload) });
                    this.showNotification('ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
                    this.closeAllModals();
                    await this.loadInitialData();
                } catch (error) {}
            }

            async handleItemFormSubmit(e) {
                e.preventDefault();
                const itemId = document.getElementById('itemId').value;
                const payload = {
                    item_name: document.getElementById('itemName').value,
                    description: document.getElementById('itemDescription').value,
                    min_stock_level: parseInt(document.getElementById('minStockLevel').value)
                };
                const method = itemId ? 'PUT' : 'POST';
                // NOTE: Backend needs to support PUT /warehouse-items/{item_id}
                const endpoint = itemId ? `/warehouse-items/${itemId}` : '/warehouse-items/';
                try {
                    await this.apiFetch(endpoint, { method, body: JSON.stringify(payload) });
                    this.showNotification('Ú©Ø§Ù„Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
                    this.closeAllModals();
                    await this.loadInitialData();
                } catch (error) {}
            }
            
            populatePanelItemsForEdit(panelCode) {
                const container = document.getElementById('panelItemsContainer');
                container.innerHTML = '';
                const items = this.panelConfigs[panelCode] || [];
                if (items.length === 0) {
                    this.addPanelItemRow(); // Add one empty row if none exist
                } else {
                    items.forEach(item => this.addPanelItemRow(item.item_name, item.quantity_required));
                }
            }
            
            editPanelConfig(panelCode) {
                this.activateTab('panel-config');
                document.getElementById('panelCodeSelect').value = panelCode;
                this.populatePanelItemsForEdit(panelCode);
            }

            addPanelItemRow(itemName = '', quantity = 1) {
                const container = document.getElementById('panelItemsContainer');
                const div = document.createElement('div');
                div.className = 'form-row';
                let itemOptions = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ù„Ø§</option>';
                itemOptions += this.items.map(i => `<option value="${i.item_name}" ${i.item_name === itemName ? 'selected' : ''}>${i.item_name}</option>`).join('');
                div.innerHTML = `
                    <select class="item-name" required style="flex-grow: 1;">${itemOptions}</select>
                    <input type="number" class="item-quantity" value="${quantity}" min="1" required style="width: 80px;">
                    <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Ø­Ø°Ù</button>
                `;
                container.appendChild(div);
            }

            async handlePanelConfigSubmit(e) {
                e.preventDefault();
                const panelCode = document.getElementById('panelCodeSelect').value;
                if (!panelCode) return this.showNotification('Ù„Ø·ÙØ§ ÛŒÚ© Ú©Ø¯ ØªØ§Ø¨Ù„Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');

                const items = Array.from(document.querySelectorAll('#panelItemsContainer .form-row')).map(row => ({
                    item_name: row.querySelector('.item-name').value,
                    quantity_required: parseInt(row.querySelector('.item-quantity').value)
                }));
                if (items.some(item => !item.item_name || !item.quantity_required)) {
                    return this.showNotification('Ù„Ø·ÙØ§ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯', 'error');
                }

                const payload = { panel_code: panelCode, items };
                try {
                    await this.apiFetch('/inventory/panel-items/', { method: 'POST', body: JSON.stringify(payload) });
                    this.showNotification(`BOM Ø¨Ø±Ø§ÛŒ ${panelCode} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`, 'success');
                    await this.loadInitialData();
                } catch(error) {}
            }

            showLowStockAlerts() {
                const container = document.getElementById('alertsContainer');
                const countBadge = document.getElementById('alertCount');
                container.innerHTML = '';
                const lowStockItems = this.inventoryData.filter(i => i.min_stock_level > 0 && i.current_stock <= i.min_stock_level);
                
                countBadge.textContent = lowStockItems.length;
                if (lowStockItems.length === 0) {
                    container.innerHTML = '<p>Ù‡ÛŒÚ† Ù‡Ø´Ø¯Ø§Ø± ÙØ¹Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
                    return;
                }
                lowStockItems.forEach(item => {
                    container.innerHTML += `<div class="alert-item critical"><span>Ú©Ø§Ù„Ø§ÛŒ <strong>${item.item_name}</strong> Ø¯Ø± Ø§Ù†Ø¨Ø§Ø± <strong>${item.warehouse_name}</strong> Ø¨Ù‡ Ø­Ø¯Ø§Ù‚Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ (${item.min_stock_level}) Ø±Ø³ÛŒØ¯Ù‡ Ø§Ø³Øª. Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: ${item.current_stock}</span></div>`;
                });
            }
            
            updateCharts() {
                this.initWarehouseStockChart();
                this.initTransactionTrendChart();
            }

            initWarehouseStockChart() {
                const series = this.warehouses.map(w => this.inventoryData.filter(i => i.warehouse_id === w.id).reduce((sum, item) => sum + item.current_stock, 0));
                const labels = this.warehouses.map(w => w.name);
                const options = { series, labels, chart: { type: 'donut', height: 300, fontFamily: 'Vazirmatn' }, legend: { position: 'bottom' }};
                if (this.charts.warehouseStock) this.charts.warehouseStock.updateOptions(options, true);
                else this.charts.warehouseStock = new ApexCharts(document.querySelector("#warehouseStockChart"), options);
                this.charts.warehouseStock.render();
            }
            
            initTransactionTrendChart() {
                const series = [{ name: 'ÙˆØ±ÙˆØ¯', data: [] }, { name: 'Ø®Ø±ÙˆØ¬', data: [] }];
                const categories = [];
                const last7Days = [...Array(7)].map((_, i) => { const d = new Date(); d.setDate(d.getDate() - i); return d.toISOString().split('T')[0]; }).reverse();
                
                last7Days.forEach(day => {
                    categories.push(new Date(day).toLocaleDateString('fa-IR', { day: 'numeric', month: 'short' }));
                    series[0].data.push(this.transactions.filter(t => t.timestamp.startsWith(day) && t.transaction_type === 'IN').reduce((sum, t) => sum + t.quantity, 0));
                    series[1].data.push(this.transactions.filter(t => t.timestamp.startsWith(day) && t.transaction_type === 'OUT').reduce((sum, t) => sum + t.quantity, 0));
                });
                
                const options = { series, chart: { type: 'bar', height: 300, fontFamily: 'Vazirmatn' }, xaxis: { categories }, dataLabels: { enabled: false }, colors: ['#27ae60', '#e74c3c'] };
                if(this.charts.transactionTrend) this.charts.transactionTrend.updateOptions(options, true);
                else this.charts.transactionTrend = new ApexCharts(document.querySelector("#transactionTrendChart"), options);
                this.charts.transactionTrend.render();
            }

            getStockStatus = (current, min) => min > 0 && current <= min ? (current <= 0 ? 'critical' : 'low') : 'normal';
            getStatusText = status => ({ normal: 'Ø¹Ø§Ø¯ÛŒ', low: 'Ú©Ù…', critical: 'Ø¨Ø­Ø±Ø§Ù†ÛŒ' }[status]);

            showNotification(message, type = 'success') {
                const notif = document.createElement('div');
                notif.className = `notification ${type}`;
                notif.textContent = message;
                document.body.appendChild(notif);
                setTimeout(() => { notif.style.opacity = '0'; notif.style.transform = 'translateX(100%)'; setTimeout(() => notif.remove(), 500); }, 3000);
            }

            setupWebSocket() {
                const ws = new WebSocket(`${location.protocol === "https:" ? "wss:" : "ws:"}//${location.host}/ws?token=${this.token}`);
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    this.showNotification(`Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ø³Ø±ÙˆØ±: ${data.type}`, 'info');
                    this.loadInitialData();
                };
                ws.onclose = () => setTimeout(() => this.setupWebSocket(), 5000);
            }
            
            generateInventoryReport(format) { this.showNotification(`Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø§ ÙØ±Ù…Øª ${format}... (Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡)`, 'info'); }
            generateTransactionReport(format) { this.showNotification(`Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú¯Ø²Ø§Ø±Ø´ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ Ø¨Ø§ ÙØ±Ù…Øª ${format}... (Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡)`, 'info'); }
            generateLowStockReport() { this.showNotification('Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù…... (Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡)', 'info'); }
        }

        window.dashboard = new WarehouseDashboard();

    </script>
</body>
</html>